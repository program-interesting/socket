<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>websocket</title>
</head>
<body>
<input id="text" value="">
<input type="submit" value="send" onclick="start()">
<input type="submit" value="close" onclick="close()">
<div id="msg"></div>
<script>
    /**
     webSocket.readyState
     0ï¼šæœªè¿æ¥
     1ï¼šè¿æ¥æˆåŠŸï¼Œå¯é€šè®¯
     2ï¼šæ­£åœ¨å…³é—­
     3ï¼šè¿æ¥å·²å…³é—­æˆ–æ— æ³•æ‰“å¼€
     */
    //åˆ›å»ºä¸€ä¸ªwebSocket å®ä¾‹
    let webSocket = new WebSocket("ws://127.0.0.1:8083");


    webSocket.onerror = function (event){
        onError(event);
    };

    // æ‰“å¼€websocket
    webSocket.onopen = function (event){
        onOpen(event);
    };

    //ç›‘å¬æ¶ˆæ¯
    webSocket.onmessage = function (event){
        onMessage(event);
    };


    webSocket.onclose = function (event){  //æœåŠ¡ç«¯å…³é—­å è§¦å‘
        onClose(event);
    };

    //å…³é—­ç›‘å¬websocket
    function onError(event){
        document.getElementById("msg").innerHTML = "<p>close</p>";
        console.log("error"+event.data);
    }

    function onOpen(event){
        console.log("open:"+sockState());
        document.getElementById("msg").innerHTML = "<p>Connect to Service</p>";
    }
    function onMessage(event){
        console.log("onMessage");
        document.getElementById("msg").innerHTML += "<p>"+event.data+"</p>"
    }

    function onClose(event){
        document.getElementById("msg").innerHTML = "<p>close</p>";
        console.log("close:"+sockState());
        webSocket.close();
    }

    function sockState(){
        let status = ['æœªè¿æ¥','è¿æ¥æˆåŠŸï¼Œå¯é€šè®¯','æ­£åœ¨å…³é—­','è¿æ¥å·²å…³é—­æˆ–æ— æ³•æ‰“å¼€'];
        return status[webSocket.readyState];
    }


    function start(event){
        console.log(webSocket);
        let msg = document.getElementById('text').value;
        document.getElementById('text').value = '';
        console.log("send:"+sockState());
        console.log("msg="+msg);
        webSocket.send("msg="+msg);
        document.getElementById("msg").innerHTML += "<p>æ¸¸å®¢ğŸ’¬: "+msg+"</p>"
    }

    function close(event){
        webSocket.close();
    }
</script>
</body>
</html>